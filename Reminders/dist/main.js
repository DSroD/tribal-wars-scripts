(()=>{function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function t(){var e=$("#tw_reminders_list");e.css({"overflow-y":"scroll","max-height":"280px"});var t=localStorage.getItem("tw_reminders");t&&"[]"!==t?JSON.parse(t).sort((function(e,t){return e.time-t.time})).forEach((function(t){var r=$("<div></div>").css({"margin-top":"4px",border:"solid 1px #7d510f",padding:"1px"}).addClass("tw_reminder_row").appendTo(e);$("<div>".concat(t.name?t.name:"---","<div>")).appendTo(r),$("<div>(".concat(new Date(t.time).toLocaleString(),")</div>")).appendTo(r);var i,a=$("<a></a>").attr("href",t.url).appendTo(r),o=function(){var e=t.time-Date.now(),n=e/36e5|0,r=n<10?("00"+n).slice(-2):""+n,o=("00"+(e/6e4%60|0)).slice(-2),d=("00"+(e/1e3%60|0)).slice(-2);if(a.text("".concat(e>0?r+":"+o+":"+d:"00:00:00")),e<0&&i)return TribalWars.playSound("chicken"),void clearInterval(i)};o(),t.time-Date.now()>0&&(i=setInterval(o,1e3)),r.attr("data-timer-id",i),r.append($("<button>x</button>").click((function(e){var r=localStorage.getItem("tw_reminders"),i=JSON.parse(r);i||(i=[]),new_reminder_obj=i.filter((function(e){return e.time!=t.time||e.url!=t.url})),localStorage.setItem("tw_reminders",JSON.stringify(new_reminder_obj)),n()})).addClass("btn btn-default").css({"margin-left":"2px"}))})):e.prepend($("<div>No reminders</div>"))}function n(){var e=$("#tw_reminder_content");$("#tw_reminders_list").find("div.tw_reminder_row").each((function(e,t){var n=parseInt(t.getAttribute("data-timer-id"));clearInterval(n)})),$("#tw_reminders_list").remove(),$('<div id="tw_reminders_list"></div>').prependTo(e),t()}function r(t,n,r){var i=localStorage.getItem("tw_reminders"),a=JSON.parse(i);if(a){if(a.filter((function(e){return e.time===t&&e.url===n&&e.name===r})).length>0)return}else!function(e){throw new TypeError('"reminders_obj" is read-only')}();var o,d=[].concat(function(t){if(Array.isArray(t))return e(t)}(o=a)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[{time:t,url:n,name:r}]);localStorage.setItem("tw_reminders",JSON.stringify(d))}function i(e){return 1e3*Math.round(new Date(Date.now()+1e3*e[0]*60*60+1e3*e[1]*60+1e3*e[2]).getTime()/1e3)}!function(e){if(!document.getElementById("tw_reminders")){$(e?"#rightcolumn":"body").prepend($("<div></div>").attr("id","tw_reminders").addClass(e?["vis","moveable","widget"]:[]).css(e?{}:{"z-index":"50000",border:"1px solid #7d510f",display:"block",position:"fixed",background:"#ebd6ab",padding:"8px"}).append($("<h4>".concat(e?'<img class="widget-button" onclick="return VillageOverview.toggleWidget( \'tw_reminders\', this );" src="graphic/minus.png">':"","Reminders</h4>")).addClass(["head","with-button","ui-sortable-handle"]))),e||$("#tw_reminders").draggable();var a=$('<div id="tw_reminder_content"></div>').addClass("widget_content").css({padding:"6px"}).appendTo("#tw_reminders");$('<div id="tw_reminders_list"></div>').prependTo(a),t(),setInterval((function(){n()}),2e4);var o=$("<div><h5>New reminder</h5></div>").css({"margin-top":"6px"}).appendTo(a).append($('<div><input type="text" id="tw-reminder-name" width="100" placeholder="Name"></input></div>').css("margin-bottom","2px"));[["tw-reminder-hours",":",99],["tw-reminder-minutes",":",59],["tw-reminder-seconds","",59]].forEach((function(e){$('<input type="number" min="0" max="'.concat(e[2],'" id="').concat(e[0],'" value="0"></input><span>').concat(e[1],"</span>")).css({width:"26px","-webkit-appearance":"none","-moz-appearance":"textfield"}).appendTo(o)})),$("<button>C</button>").click((function(e){var t=[$("#tw-reminder-hours").val(),$("#tw-reminder-minutes").val(),$("#tw-reminder-seconds").val()].map((function(e){return parseInt(e)}));-1===t.findIndex((function(e){return isNaN(e)}))&&(r(i(t),location.href,$("#tw-reminder-name").val()),n())})).addClass("btn btn-default free_send_button").css({"margin-left":"4px"}).appendTo(o),$("<button>T</button>").click((function(e){var t,i,a=[$("#tw-reminder-hours").val(),$("#tw-reminder-minutes").val(),$("#tw-reminder-seconds").val()].map((function(e){return parseInt(e)}));-1===a.findIndex((function(e){return isNaN(e)}))&&(r((t=a,i=new Date,t[0]<i.getHours()||t[0]===i.getHours()&&t[1]<i.getMinutes()?1e3*Math.round(new Date(i.getFullYear(),i.getMonth(),i.getDate()+1,t[0],t[1],t[2]).getTime()/1e3):1e3*Math.round(new Date(i.getFullYear(),i.getMonth(),i.getDate(),t[0],t[1],t[2]).getTime()/1e3)),location.href,$("#tw-reminder-name").val()),n())})).addClass("btn btn-default free_send_button").css({"margin-left":"4px"}).appendTo(o)}}(location.href.includes("screen=overview")&&!location.href.includes("screen=overview_")),location.href.includes("mode=scavenge")&&($("span.icon.header.time:visible").parent().append("</br>"),$("span.icon.header.time:visible").parent().append($("<button>Reminder</button>").click((function(e){var t=i(e.target.parentNode.children[1].innerText.split(":").map((function(e){return parseInt(e)})));e.target.disabled=!0,r(t,location.href,"Scavenge"),n()})).css("margin-left","4px").addClass("btn btn-default")))})();