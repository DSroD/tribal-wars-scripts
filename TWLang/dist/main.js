(()=>{var e={544:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.std_env=void 0;const n=t(993);r.std_env=new Map([["wood",(0,n.TWNumber)(window.game_data?.village.wood??0)],["iron",(0,n.TWNumber)(window.game_data?.village.iron??0)],["stone",(0,n.TWNumber)(window.game_data?.village.stone??0)],["storage",(0,n.TWNumber)(window.game_data?.village.storage_max??0)],["wood-pm",(0,n.TWNumber)(60*(window.game_data?.village.wood_prod??0))],["iron-pm",(0,n.TWNumber)(60*(window.game_data?.village.iron_prod??0))],["stone-pm",(0,n.TWNumber)(60*(window.game_data?.village.stone_prod??0))],["popul",(0,n.TWNumber)(window.game_data?.village.pop??0)],["popul-max",(0,n.TWNumber)(window.game_data?.village.pop_max??0)],["village-name",(0,n.TWString)(window.game_data?.village.name??"")],["coords",[n.TWObjectType.List,[(0,n.TWNumber)(window.game_data?.village.x??-1),(0,n.TWNumber)(window.game_data?.village.y??-1)]]],["speed-spear",(0,n.TWNumber)(18)],["speed-sword",(0,n.TWNumber)(22)],["speed-axe",(0,n.TWNumber)(18)],["speed-archer",(0,n.TWNumber)(18)],["speed-spy",(0,n.TWNumber)(9)],["speed-light",(0,n.TWNumber)(10)],["speed-marcher",(0,n.TWNumber)(10)],["speed-heavy",(0,n.TWNumber)(11)],["speed-ram",(0,n.TWNumber)(30)],["speed-catapult",(0,n.TWNumber)(30)],["speed-knight",(0,n.TWNumber)(10)],["speed-snob",(0,n.TWNumber)(35)]])},871:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.eval_obj=void 0;const n=t(400),o=t(993),a=t(281);function u(e,r){return(0,n.match)(e[0]).with(o.TWObjectType.Lambda,(()=>a.ResultFactory.Result(e))).with(o.TWObjectType.List,(()=>function(e,r){let t=e[1][0];return(0,n.match)(t).with((0,o.Symbol)("if"),(()=>function(e,r){if(4!==e[1].length)return a.ResultFactory.StringError("Expected if (condition) (true branch) (false branch)");let t=u(e[1][1],r);if(!t.is_successful)return t.append_error("Error during evaluating if clause condition");let n=t.unwrap();return c(n,o.TWObjectType.Bool)?n[1]?u(e[1][2],r):u(e[1][3],r):a.ResultFactory.StringError("Error: if clause condition is not boolean")}(e,r))).with((0,o.Symbol)("begin"),(()=>{let t=a.ResultFactory.Result(o.Void);for(let n of e[1].slice(1))t=u(n,r);return t})).with((0,o.Symbol)("define"),(()=>{if(3!==e[1].length)return a.ResultFactory.StringError("Syntax error: define is expecting an identifier and an object");let t=e[1][1];if(t[0]!=o.TWObjectType.Symbol)return a.ResultFactory.StringError(`Syntax error: invalid identifier at declare ${t[1]}`);let n=u(e[1][2],r);return n.is_successful?(r.set(t[1],n.unwrap()),a.ResultFactory.Result(o.Void)):n.append_error(`Error defining symbol ${t[1]}`)})).with((0,o.Symbol)("+"),(()=>s(((e,r)=>a.ResultFactory.Result((0,o.TWNumber)(e[1]+r[1]))),e,r,o.TWObjectType.Number))).with((0,o.Symbol)("-"),(()=>s(((e,r)=>a.ResultFactory.Result((0,o.TWNumber)(e[1]-r[1]))),e,r,o.TWObjectType.Number))).with((0,o.Symbol)("*"),(()=>s(((e,r)=>a.ResultFactory.Result((0,o.TWNumber)(e[1]*r[1]))),e,r,o.TWObjectType.Number))).with((0,o.Symbol)("/"),(()=>function(e,r,t,n,i){if(3!==r[1].length)return a.ResultFactory.StringError(`Expected 2 parameters for operation '${r[1][0][1]}'.`);let s=u(r[1][1],t),l=u(r[1][2],t);if(!s.is_successful)return s.append_error(`Error evaluating left operand of ${r[1][0][1]}.`);if(!l.is_successful)return l.append_error(`Error evaluating right operand of ${r[1][0][1]}.`);let p=s.unwrap(),f=l.unwrap();return c(p,n)?c(f,i)?(d=p,0===(g=f)[1]?a.ResultFactory.StringError("Cannot divide by zero"):a.ResultFactory.Result((0,o.TWNumber)(d[1]/g[1]))):a.ResultFactory.StringError(`Type mismatch in right argument of ${r[1][0][1]}`):a.ResultFactory.StringError(`Type mismatch in left argument of ${r[1][0][1]}`);var d,g}(0,e,r,o.TWObjectType.Number,o.TWObjectType.Number))).with((0,o.Symbol)("sqr"),(()=>{if(2!==e[1].length)return a.ResultFactory.StringError("Expected 1 argument for sqr");let t=u(e[1][1],r);if(!t.is_successful)return t.append_error("Error evaluating an argument during 'sqrr' function call.");let n=t.unwrap();if(n[0]!==o.TWObjectType.Number)return a.ResultFactory.StringError("Expected Number as an argument for sqr.");let i=n[1];return a.ResultFactory.Result((0,o.TWNumber)(i*i))})).with((0,o.Symbol)("sqrt"),(()=>{if(2!==e[1].length)return a.ResultFactory.StringError("Expected 1 argument for sqrt.");let t=u(e[1][1],r);if(!t.is_successful)return t.append_error("Error evaluating an argument during 'sqrt' function call.");let n=t.unwrap();if(n[0]!==o.TWObjectType.Number)return a.ResultFactory.StringError("Expected Number as an argument for sqrt.");let i=n[1];return i<0?a.ResultFactory.StringError("Function sqrt requires positive number as an argument"):a.ResultFactory.Result((0,o.TWNumber)(Math.sqrt(i)))})).with((0,o.Symbol)("car"),(()=>{if(2!==e[1].length)return a.ResultFactory.StringError("Expected 1 argument for car.");if(e[1][1][0]===o.TWObjectType.Void)return a.ResultFactory.StringError("Expected List as an argument for car.");let t=u(e[1][1],r);if(!t.is_successful)return t.append_error("Error evaluating an argument during 'car' function call.");let n=t.unwrap();if(n[0]!==o.TWObjectType.List)return a.ResultFactory.StringError("Expected List as an argument for car.");let i=n;if(i[1].length<1)return a.ResultFactory.StringError("Argument for car can not be empty.");let s=i[1][0];return a.ResultFactory.Result(s)})).with((0,o.Symbol)("cdr"),(()=>{if(2!==e[1].length)return a.ResultFactory.StringError("Expected 1 argument for cdr.");if(e[1][1][0]===o.TWObjectType.Void)return a.ResultFactory.StringError("Expected List as an argument for cdr.");let t=u(e[1][1],r);if(!t.is_successful)return t.append_error("Error evaluating an argument during 'cdr' function call.");let n=t.unwrap();if(n[0]!==o.TWObjectType.List)return a.ResultFactory.StringError("Expected List as an argument for cdr.");let i=n;if(i[1].length<1)return a.ResultFactory.StringError("Argument for cdr can not be empty.");let s=i[1].slice(1);return a.ResultFactory.Result([o.TWObjectType.List,s])})).with((0,o.Symbol)("lambda"),(()=>function(e,r){if(3!==e[1].length)return a.ResultFactory.StringError("Syntax error: expected lambda (params) (body)");let t=e[1][1];if(t[0]!=o.TWObjectType.List)return a.ResultFactory.StringError("Syntax error: expected lambda (params) (body)");let n=[];for(let e of t[1]){if(e[0]!=o.TWObjectType.Symbol)return a.ResultFactory.StringError("Syntax error: invalid lambda parameter");n.push(e[1])}let u=e[1][2];if(u[0]!=o.TWObjectType.List)return a.ResultFactory.StringError("Syntax error: invalid lambda body");let i=[o.TWObjectType.List,u[1]],s=[o.TWObjectType.Lambda,[n,i]];return a.ResultFactory.Result(s)}(e))).with((0,o.Symbol)("persist-var"),(()=>{let t=e[1].slice(1),n=[];for(let e of t){if(e[0]!==o.TWObjectType.Symbol)return a.ResultFactory.StringError("Expected symbol of variable to persist.");let t=i(e,r);if(!t.is_successful)return t.append_error(`Error persisting symbol ${e[1]}`);n.push([e[1],t.unwrap()])}if(!window.game_data?.world)return a.ResultFactory.StringError("Game data not found, persistence is tied to game world");let u=localStorage.getItem(`${window.game_data?.world}_twlang_stored_env`),s=JSON.parse(u??"");return s.push(...n),localStorage.setItem(`${window.game_data?.world}_twlang_stored_env`,JSON.stringify(s)),a.ResultFactory.Result(o.Void)})).with([o.TWObjectType.Symbol,n.P._],(()=>{let n=i(t,r);return n.is_successful&&n.unwrap()[0]===o.TWObjectType.Lambda?function(e,r,t){let n=r[1][1][1],o=r[1].slice(1),i=e[1][0];if(o.length!==i.length)return a.ResultFactory.StringError(`Lambda ${n} requires ${i.length} parameters (${i.join(", ")})`);let s=new Map(t);return i.forEach(((e,r,a)=>{let i=u(o[r],t);if(!i.is_successful)return i.append_error(`Error evaluating an argument during ${n} function call`);s.set(e,i.unwrap())})),u(e[1][1],s)}(n.unwrap(),e,r):n})).otherwise((()=>{let t=[o.TWObjectType.List,[]];for(let n of e[1]){let e=u(n,r);if(!e.is_successful)return e.append_error("Error evaluating objects in list.");e.unwrap()[0]!==o.TWObjectType.Void&&t[1].push(e.unwrap())}return a.ResultFactory.Result(t)}))}(e,r))).with(o.TWObjectType.Symbol,(()=>i(e,r))).otherwise((()=>a.ResultFactory.Result(e)))}function i(e,r){let t=r.get(e[1]);return t?a.ResultFactory.Result(t):a.ResultFactory.StringError(`Unbound symbol ${e[1]}.`)}function s(e,r,t,n){if(r[1].length<3)return a.ResultFactory.StringError(`Expected at least 2 parameters for operation '${r[1][0][1]}'.`);let o=[];for(let e of r[1].slice(1)){let n=u(e,t);if(!n.is_successful)return n.append_error(`Error evaluating argument in function call '${r[1][0][1]}'`);o.push(n.unwrap())}if(!function(e,r){for(let t of e)if(t[0]!==r)return!1;return!0}(o,n))return a.ResultFactory.StringError(`Type mismatch in function call '${r[1][0][1]}'.`);let i=a.ResultFactory.Result(o[0]);for(let r of o.slice(1))if(i=e(i.unwrap(),r),!i.is_successful)return i;return i}function c(e,r){return e[0]===r}r.eval_obj=u},993:(e,r)=>{"use strict";var t;Object.defineProperty(r,"__esModule",{value:!0}),r.Symbol=r.TWString=r.False=r.True=r.One=r.Zero=r.TWNumber=r.Void=r.TWObjectType=void 0,function(e){e[e.Void=0]="Void",e[e.Number=1]="Number",e[e.Bool=2]="Bool",e[e.String=3]="String",e[e.Lambda=4]="Lambda",e[e.List=5]="List",e[e.Symbol=6]="Symbol"}(t=r.TWObjectType||(r.TWObjectType={})),r.Void=[t.Void],r.TWNumber=e=>[t.Number,e],r.Zero=[t.Number,0],r.One=[t.Number,1],r.True=[t.Bool,!0],r.False=[t.Bool,!1],r.TWString=e=>[t.String,e],r.Symbol=function(e){return[t.Symbol,e]}},337:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.parse=void 0;const n=t(400),o=t(993),a=t(281),u=t(176);var i;!function(e){e[e.Continue=0]="Continue",e[e.Return=1]="Return"}(i||(i={})),r.parse=function e(r,t=!0){let s=[o.TWObjectType.List,[]],c=r.pop();if(c?.t!==u.TokenType.LParen)return a.ResultFactory.StringError(`Expected '(', found ${c?.v||"nothing"}`);for(;r.length>0;){let c=r.pop();if(void 0===c)return a.ResultFactory.StringError("Insufficient tokens.");let l=(0,n.match)(c.t).with(u.TokenType.LParen,(()=>{r.push({t:u.TokenType.LParen,v:null});let t=e(r,!1);return t.is_successful?(s[1].push(t.unwrap()),a.ResultFactory.Result(i.Continue)):a.ResultFactory.StringError(t.error??"Unknown error during list parse...")})).with(u.TokenType.RParen,(()=>a.ResultFactory.Result(i.Return))).with(u.TokenType.Number,(()=>(s[1].push([o.TWObjectType.Number,c.v]),a.ResultFactory.Result(i.Continue)))).with(u.TokenType.String,(()=>{let e=c;return s[1].push([o.TWObjectType.String,e.v]),a.ResultFactory.Result(i.Continue)})).with(u.TokenType.Symbol,(()=>{return s[1].push((e=c.v,(0,n.match)(e).with("#true",(()=>o.True)).with("#false",(()=>o.False)).otherwise((()=>[o.TWObjectType.Symbol,e])))),a.ResultFactory.Result(i.Continue);var e})).otherwise((()=>a.ResultFactory.StringError("Unknown token found. This due to an error in the parser.")));if(!l.is_successful)return l.append_error("Error parsing input:");if(l.unwrap()===i.Return&&t&&r.length>0)return a.ResultFactory.StringError(`Unexpected tokens: ${r.map((e=>(0,u.get_token_type_name)(e))).join("")}`);if(l.unwrap()===i.Return)return a.ResultFactory.Result(s)}return a.ResultFactory.StringError("Unexpected end of input. Are you missing a ')'?")}},281:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.is_successful=r.is_error=r.ResultFactory=void 0;class t{static Error(e,r){return{error:e,is_successful:!1,append_error:r}}static Result(e){return{result:e,is_successful:!0,unwrap:()=>e}}static StringError(e){return{error:e,is_successful:!1,append_error:r=>t.StringError(r+"\n"+e)}}}r.ResultFactory=t,r.is_error=function(e){return!e.is_successful},r.is_successful=function(e){return e.is_successful}},176:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.tokenize=r.get_token_type_name=r.is_token=r.TokenType=void 0;const n=t(400),o=t(281);var a;!function(e){e[e.LParen=0]="LParen",e[e.RParen=1]="RParen",e[e.Number=2]="Number",e[e.String=3]="String",e[e.Symbol=4]="Symbol"}(a=r.TokenType||(r.TokenType={})),r.is_token=function(e,r){return e.t===r},r.get_token_type_name=function(e){return(0,n.match)(e).when((e=>e.t===a.LParen),(()=>"(")).when((e=>e.t===a.RParen),(()=>")")).when((e=>e.t===a.Number),(e=>""+e.v)).when((e=>e.t===a.String),(e=>e.v)).when((e=>e.t===a.Symbol),(e=>e.v)).exhaustive()};const u=[" ","(",")"];function i(e,r=!1){return(0,n.match)(e).with("(",(()=>({t:a.LParen,v:null}))).with(")",(()=>({t:a.RParen,v:null}))).otherwise((e=>{if(r)return{t:a.String,v:e};let t=parseFloat(e);return isNaN(t)?{t:a.Symbol,v:e}:{t:a.Number,v:t}}))}r.tokenize=function(e){let r={parsed_tokens:[],character_buffer:[],is_parsing_string:!1,expected_characters:["("],errors:[]},t=e.replaceAll("\r"," ").replaceAll("\n"," ");return Array.from(t).forEach(((e,t,n)=>{let o=!0;for(let t=r.expected_characters.pop();r.expected_characters.length>0&&(o=t===e,!o);t=r.expected_characters.pop());if(!o)return void r.errors.push(`Unexpected character ${e}: ${t+1}.`);if(!r.is_parsing_string&&u.some((r=>e===r)))return r.character_buffer.length>0&&(r.parsed_tokens.push(i(r.character_buffer.join(""))),r.character_buffer=[]),void(" "!==e&&r.parsed_tokens.push(i(e)));let a='"'===e&&"\\"!==n[t-1];if(a&&r.character_buffer.length>0&&!r.is_parsing_string&&r.errors.push(`Unexpected string quote: ${t+1}.`),a&&r.is_parsing_string)return r.expected_characters.push(" "),r.parsed_tokens.push(i(r.character_buffer.join(""),!0)),r.character_buffer=[],void(r.is_parsing_string=!1);a?r.is_parsing_string=!0:"\\"===e&&"\\"!==n[t-1]||r.character_buffer.push(e)})),r.errors.length>0?o.ResultFactory.StringError(r.errors.join("\n")):o.ResultFactory.Result(r.parsed_tokens.reverse())}},400:(e,r)=>{var t=Symbol("@ts-pattern/matcher"),n="@ts-pattern/anonymous-select-key",o=function(e){return Boolean(e&&"object"==typeof e)},a=function(e){return e&&!!e[t]},u=function e(r,n,u){if(o(r)){if(a(r)){var i=r[t]().match(n),s=i.matched,c=i.selections;return s&&c&&Object.keys(c).forEach((function(e){return u(e,c[e])})),s}if(!o(n))return!1;if(Array.isArray(r))return!!Array.isArray(n)&&r.length===n.length&&r.every((function(r,t){return e(r,n[t],u)}));if(r instanceof Map)return n instanceof Map&&Array.from(r.keys()).every((function(t){return e(r.get(t),n.get(t),u)}));if(r instanceof Set){if(!(n instanceof Set))return!1;if(0===r.size)return 0===n.size;if(1===r.size){var l=Array.from(r.values())[0];return a(l)?Array.from(n.values()).every((function(r){return e(l,r,u)})):n.has(l)}return Array.from(r.values()).every((function(e){return n.has(e)}))}return Object.keys(r).every((function(o){var i,s=r[o];return(o in n||a(i=s)&&"optional"===i[t]().matcherType)&&e(s,n[o],u)}))}return Object.is(n,r)},i=function e(r){var n,u,i;return o(r)?a(r)?null!=(n=null==(u=(i=r[t]()).getSelectionKeys)?void 0:u.call(i))?n:[]:Array.isArray(r)?s(r,e):s(Object.values(r),e):[]},s=function(e,r){return e.reduce((function(e,t){return e.concat(r(t))}),[])};function c(e){var r;return(r={})[t]=function(){return{match:function(r){var t={},n=function(e,r){t[e]=r};return void 0===r?(i(e).forEach((function(e){return n(e,void 0)})),{matched:!0,selections:t}):{matched:u(e,r,n),selections:t}},getSelectionKeys:function(){return i(e)},matcherType:"optional"}},r}function l(e){var r;return(r={})[t]=function(){return{match:function(r){if(!Array.isArray(r))return{matched:!1};var t={};if(0===r.length)return i(e).forEach((function(e){t[e]=[]})),{matched:!0,selections:t};var n=function(e,r){t[e]=(t[e]||[]).concat([r])};return{matched:r.every((function(r){return u(e,r,n)})),selections:t}},getSelectionKeys:function(){return i(e)}}},r}function p(){var e,r=[].slice.call(arguments);return(e={})[t]=function(){return{match:function(e){var t={},n=function(e,r){t[e]=r};return{matched:r.every((function(r){return u(r,e,n)})),selections:t}},getSelectionKeys:function(){return s(r,i)},matcherType:"and"}},e}function f(){var e,r=[].slice.call(arguments);return(e={})[t]=function(){return{match:function(e){var t={},n=function(e,r){t[e]=r};return s(r,i).forEach((function(e){return n(e,void 0)})),{matched:r.some((function(r){return u(r,e,n)})),selections:t}},getSelectionKeys:function(){return s(r,i)},matcherType:"or"}},e}function d(e){var r;return(r={})[t]=function(){return{match:function(r){return{matched:!u(e,r,(function(){}))}},getSelectionKeys:function(){return[]},matcherType:"not"}},r}function g(e){var r;return(r={})[t]=function(){return{match:function(r){return{matched:Boolean(e(r))}}}},r}function m(){var e,r=[].slice.call(arguments),o="string"==typeof r[0]?r[0]:void 0,a=2===r.length?r[1]:"string"==typeof r[0]?void 0:r[0];return(e={})[t]=function(){return{match:function(e){var r,t=((r={})[null!=o?o:n]=e,r);return{matched:void 0===a||u(a,e,(function(e,r){t[e]=r})),selections:t}},getSelectionKeys:function(){return[null!=o?o:n].concat(void 0===a?[]:i(a))}}},e}var y=g((function(e){return!0})),h=y,b=g((function(e){return"string"==typeof e})),v=g((function(e){return"number"==typeof e})),_=g((function(e){return"boolean"==typeof e})),w=g((function(e){return"bigint"==typeof e})),T=g((function(e){return"symbol"==typeof e})),S=g((function(e){return null==e})),R={__proto__:null,optional:c,array:l,intersection:p,union:f,not:d,when:g,select:m,any:y,_:h,string:b,number:v,boolean:_,bigint:w,symbol:T,nullish:S,instanceOf:function(e){return g(function(e){return function(r){return r instanceof e}}(e))},typed:function(){return{array:l,optional:c,intersection:p,union:f,not:d,select:m,when:g}}},E=function(){function e(e,r){this.value=void 0,this.cases=void 0,this.value=e,this.cases=r}var r=e.prototype;return r.with=function(){var r=[].slice.call(arguments),t=r[r.length-1],o=[r[0]],a=[];return 3===r.length&&"function"==typeof r[1]?(o.push(r[0]),a.push(r[1])):r.length>2&&o.push.apply(o,r.slice(1,r.length-1)),new e(this.value,this.cases.concat([{match:function(e){var r={},t=Boolean(o.some((function(t){return u(t,e,(function(e,t){r[e]=t}))}))&&a.every((function(r){return r(e)})));return{matched:t,value:t&&Object.keys(r).length?n in r?r[n]:r:e}},handler:t}]))},r.when=function(r,t){return new e(this.value,this.cases.concat([{match:function(e){return{matched:Boolean(r(e)),value:e}},handler:t}]))},r.otherwise=function(r){return new e(this.value,this.cases.concat([{match:function(e){return{matched:!0,value:e}},handler:r}])).run()},r.exhaustive=function(){return this.run()},r.run=function(){for(var e=this.value,r=void 0,t=0;t<this.cases.length;t++){var n=this.cases[t],o=n.match(this.value);if(o.matched){e=o.value,r=n.handler;break}}if(!r){var a;try{a=JSON.stringify(this.value)}catch(e){a=this.value}throw new Error("Pattern matching error: no pattern matches value "+a)}return r(e,this.value)},e}();r.P=R,r.Pattern=R,r.isMatching=function(){var e=[].slice.call(arguments);if(1===e.length){var r=e[0];return function(e){return u(r,e,(function(){}))}}if(2===e.length){var t=e,n=t[0],o=t[1];return u(n,o,(function(){}))}throw new Error("isMatching wasn't given the right number of arguments: expected 1 or 2, received "+e.length+".")},r.match=function(e){return new E(e,[])}}},r={};function t(n){var o=r[n];if(void 0!==o)return o.exports;var a=r[n]={exports:{}};return e[n](a,a.exports,t),a.exports}(()=>{"use strict";const e=t(400),r=t(544),n=t(871),o=t(993),a=t(337),u=t(176);function i(e){e.is_successful?s(c(e.unwrap())):s(e.error??"Error...","red")}function s(e,r="black"){let t=$("#twlang_repl_out");$("<div></div>").text(e).css({display:"block",border:"solid 1px #7d510f",padding:"1px","margin-top":"1px",color:r}).appendTo(t),t.scrollTop(t.get(0)?.scrollHeight??0)}function c(r){return(0,e.match)(r[0]).with(o.TWObjectType.Lambda,o.TWObjectType.Void,o.TWObjectType.Symbol,(()=>"#nil")).with(o.TWObjectType.List,(()=>`(${r[1].map((e=>c(e))).join(" ")})`)).otherwise((()=>""+r[1]))}function l(e){let t=(0,u.tokenize)(e);if(!t.is_successful)return t.append_error("Evaluation error");let o=(0,a.parse)(t.unwrap().map((e=>e)));return o.is_successful?(0,n.eval_obj)(o.unwrap(),r.std_env):o}!function(){window.twlang_std=r.std_env,async function(e){if(!window.game_data)return;let r=localStorage.getItem(`${window.game_data.world}_twlang_stored_env`);r||(await function(){if(window.game_data){var e=`https://${window.game_data.world}.divokekmeny.cz/page/settings`;return fetch(e).then((e=>e.text())).then((e=>function(e){var r=(new DOMParser).parseFromString(e,"text/html");return{world_speed:parseFloat(r.getElementsByClassName("data-table")[0].rows[0].cells[1].textContent??"1"),unit_speed:parseFloat(r.getElementsByClassName("data-table")[0].rows[1].cells[1].textContent??"1")}}(e))).catch((e=>({world_speed:1,unit_speed:1}))).then((e=>{if(!window.game_data)return;let r=[["unit-speed",(0,o.TWNumber)(e.unit_speed)],["world-speed",(0,o.TWNumber)(e.world_speed)]];localStorage.setItem(`${window.game_data.world}_twlang_stored_env`,JSON.stringify(r))}))}}(),r=localStorage.getItem(`${window.game_data.world}_twlang_stored_env`)),JSON.parse(r??"").forEach((r=>{e.set(r[0],r[1])}))}(r.std_env);let e=$('<div id="twlang_repl"></div>').prependTo($("body")).css({"z-index":"60000",border:"1px solid #7d510f",display:"block",position:"fixed",background:"#ebd6ab",overflow:"hidden"}).addClass(["vis moveable"]).draggable({handle:"h4"}).append($("<h4>TWLang REPL</h4>").addClass(["head"])),t=$('<div id="twlang_repl_content"></div>').css({padding:"8px"}).appendTo(e);$('<div id="twlang_repl_out"></div>').css({width:"390px",height:"360px","overflow-y":"scroll"}).appendTo(t),$("<div></div>").append($('<textarea id="twlang_input"></textarea>').css({width:"360px",resize:"vertical"}).on("keydown",(e=>{if(e.ctrlKey&&13===e.keyCode){let e=$("#twlang_input").val()??"";s("twlang > "+e,"green"),i(l(e))}}))).append($("<button>eval</button>").on("click",(()=>{let e=$("#twlang_input").val()??"";s("twlang > "+e,"green"),i(l(e))}))).appendTo(t)}()})()})();